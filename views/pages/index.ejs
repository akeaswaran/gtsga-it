<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="author" content="Akshay Easwaran">
  <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="lib/jquery-ui/jquery-ui.min.css">
  <style>
	h1 {
		display: inline-block;
	}
	.header-button {
		display: inline-block;
		margin-top: 10px;
	}

	button > .card-button {
		text-color: gray;
	}
  </style>
	<title>GT SGA IT Committee - Project Queue</title>
  <script src="lib/jquery-1.12.0.min.js"></script>
  <script src="lib/jquery-ui/jquery-ui.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.min.js"></script>
  <script>
	function deleteCard(element, cardId) {
		if(confirm('Do you want to delete this card?')) {
			//delete from db
			$.ajax({
			  type: "DELETE",
			  url: 'https://gtsga-it.herokuapp.com/cards',
			  data: JSON.stringify({id : cardId}),
				dataType: 'json',
				error: function(jqXHR, textStatus, errorThrown) {
					//show error message
					console.log(errorThrown);
				},
				success : function (data, textStatus, jqXHR) {
					var card = data;
					$('#card-' + card.id).remove();
				}
			}).done(function(data) {
				console.log('DONE DELETE W\/ data: ' + data);
			});
		}
	}

	function createCard(card) {
		var cardHtml = '<div id="card-' + card.id + '" class="panel panel-default card backlog"><div class="panel-body"><button type="button" class="btn btn-danger btn-xs pull-right card-button" onClick=\"deleteCard(this, \'' + card.id + '\')\"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete</button><h3>' + card.title + '</h3><p>' + card.description + '</p></div></div>';
		$('#backlogWell').append(cardHtml);
		$('.card').draggable({
			containment: '.container-fluid',
			stack: '.wells',
			snap: '.well',
			snapTolerance: '20px',
			snapMode: 'inner',
			cursor: 'move',
			revert: true
		});
	}

	function addCard(cardDict) {
		console.log('START ADD');
		$.ajax({
		  type: "POST",
			contentType: "application/json",
		  url: 'https://gtsga-it.herokuapp.com/cards',
		  data: JSON.stringify({
				title: cardDict.title,
				description: cardDict.description
			}),
			dataType: 'json',
			error: function(jqXHR, textStatus, errorThrown) {
				//show error message
				console.log('ERROR: ' + errorThrown);
			},
			success : function (data, textStatus, jqXHR) {
				console.log('CREATING HTML CARD');
				var card = data;
				console.log(card)
				createCard(card);
	      $('#card-title').val('');
	      $('#card-description').val('');
			}
		}).done(function(data) {
			console.log('DONE ADD W\/ data: ' + data);
		});
	}

  $(document).ready(function() {
		var numCards = 0;
		$.get('https://gtsga-it.herokuapp.com/cards/', function(data) {
			numCards = data.length;
			for (var i = 0; i < data.length; i++) {
				var card = data[i];
				createCard(card);
			}
		});

    $('#progressWell').droppable({
      accept: '.card',
      drop: function(ev, ui) {
       var dropped = ui.draggable;
       var droppedOn = $(this);
       $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
			 $(dropped).removeClass('backlog');
			 $(dropped).removeClass('done');
			 $(dropped).addClass('in-progress');
      }
    });

    $('#backlogWell').droppable({
      accept: '.card',
      drop: function(ev, ui) {
       var dropped = ui.draggable;
       var droppedOn = $(this);
       $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
			 $(dropped).addClass('backlog');
			 $(dropped).removeClass('done');
			 $(dropped).removeClass('in-progress');
      }
    });

    $('#doneWell').droppable({
      accept: '.card',
      drop: function(ev, ui) {
       var dropped = ui.draggable;
       var droppedOn = $(this);
       $(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
			 $(dropped).removeClass('backlog');
			 $(dropped).addClass('done');
			 $(dropped).removeClass('in-progress');
      }
    });

    $('#saveButton').on('click', function(event) {
			event.preventDefault();
      $('#newCardModal').modal('toggle');
			var card = {
				title : 'IT-' + numCards + ': ' + $('#card-title').val(),
				description : $('#card-description').val()
			};
			addCard(card);
    });
  });
	</script>
</head>
<body>
  <div class="container-fluid">
    <div class="modal fade" id="newCardModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">New Card</h4>
          </div>
          <div class="modal-body">
            <form>
             <div class="form-group">
               <label for="recipient-name" class="control-label">Title</label>
               <input type="text" class="form-control" id="card-title">
             </div>
             <div class="form-group">
               <label for="message-text" class="control-label">Description</label>
               <textarea class="form-control" id="card-description"></textarea>
             </div>
           </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" id="saveButton">Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="page-header">
			<div class="row">
		  	<div class="col-md-6"><h1>Georgia Tech SGA IT Committee <small>Project Queue</small></h1></div>
		  	<div class="col-md-6"><button type="button" id="addCard" class="btn btn-default btn-lg pull-right header-button" autocomplete="off" data-toggle="modal" data-target="#newCardModal"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Create Card</button></div>
			</div>
    </div>

    <div class="wells">
      <div class="col-md-4">
        <h3>Backlog</h3>
        <div class="well" id="backlogWell">
        </div>
      </div>
      <div class="col-md-4">
        <h3>In Progress</h3>
        <div class="well" id="progressWell">
        </div>
      </div>
      <div class="clearfix visible-xs-block"></div>
      <div class="col-md-4">
        <h3>Done</h3>
        <div class="well" id="doneWell">
        </div>
      </div>
    </div>
  </div>
</body>
</html>
